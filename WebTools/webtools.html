<!--
    Auther     : \u4e8e\u5929\u5947
    Date      : 1481737888000
    Version    : 0.9.2 beta
-->


<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>sTool</title>
    <style type="text/css">
        body {
            font: 14px Consolas;
            text-align: left;
        }

        #frame {
            width: 1500px;
        }

        #header1 {
            font: 19px Consolas;
            font-weight: bold;
            margin-bottom: 15px;
        }

        #left {
            float: left;
            width: 10px;
        }

        div.field {
            margin-bottom: 5px;
            text-align: left;
        }

        div.text {
            margin-bottom: 5px;
            text-align: center;
            width: 40px
        }

        input[readonly] {
            background-color: none;
            border: none;
        }

        textarea {
            font: 14px Consolas;
        }
    </style>

    <script type="text/javascript">

        var blurElementId = "";

        /**
         * 页面加载初始化
         */
        window.onload = function () {
            var now = new Date();
            initTransferUtcTimeToUnixTime(now);
            initTransferUnixTimestampToLocalTime(now);
            initWorldTimeConvert(now);
        }



        /**
         * 初始化各时区时间转换为Unix时间戳
         */
        function initTransferUtcTimeToUnixTime(jsDateTime) {
            var localeDateString = jsDateTime.toLocaleDateString();
            var timeString = jsDateTime.toTimeString().split(" ")[0];
            var dateArr = localeDateString.split("/");
            var timeArr = timeString.split(":");
            var year = dateArr[0];
            var month = dateArr[1];
            var day = dateArr[2];
            var hour = timeArr[0];
            var minute = timeArr[1];
            var second = timeArr[2];

            document.getElementById("year").value = year;
            document.getElementById("month").value = month;
            document.getElementById("day").value = day;
            document.getElementById("hour").value = hour;
            document.getElementById("minute").value = minute;
            document.getElementById("second").value = second;
        }

        /**
         * 初始化Unix时间转换为各时区时间
         */
        function initTransferUnixTimestampToLocalTime(jsDateTime) {
            document.getElementById("unixTimeIn1").value = parseInt(jsDateTime.valueOf() / 1000) * 1000;
        }

        /**
         * 初始化世界标准时间转换
         */
        function initWorldTimeConvert(now) {
            document.getElementById("inputZoneTime").value = convertJsDateToString(now);
        }

        /**
         * 将各时区时间转换为Unix时间戳
         */
        function transferUtcTimeToUnixTime(value) {
            var year = document.getElementById("year").value;
            var month = document.getElementById("month").value;
            var day = document.getElementById("day").value;
            var hour = document.getElementById("hour").value;
            var minute = document.getElementById("minute").value;
            var second = document.getElementById("second").value;

            var timestamp = new Date(year, month - 1, day, hour, minute, second).getTime() + (8 - value) * 3600 * 1000;
            document.getElementById("unixTimeOut").value = timestamp;
            // execCopy("unixTimeOut");
        }


        /**
         * 将Unix时间戳转换为各时区时间
         */
        function transferUnixTimestampToLocalTimeJs(localTimeZone) {
            var unixTime = fillUnixTime(document.getElementById("unixTimeIn1").value);
            document.getElementById("unixTimeIn1").value = unixTime;
            document.getElementById("utcTime1").value = transferUnixTimestampToLocalTimeStr(unixTime, localTimeZone);
        }

        function fillUnixTime(unixTime) {
            unixTime = unixTime.replaceAll(" ", "").toUpperCase();
            if (unixTime.startsWith("0X")) {
                unixTime = unixTime.substring(2, unixTime.length);
            }
            if (unixTime.length == 8) {
                unixTime = parseInt(unixTime, 16).toString(10);
            }
            if (unixTime.length == 9 || unixTime.length == 10) {
                unixTime += "000";
            }
            if (unixTime.length == 19 && unixTime.endsWith("000000")) {
                unixTime = unixTime.substr(0, 13);
            }
            return unixTime;
        }


        function transferUnixTimestampToLocalTime(unixTime, localTimeZone) {
            // 0时区时间
            return new Date(parseInt(unixTime) + new Date().getTimezoneOffset() * 60000 + localTimeZone * 3600000);
        }


        function transferUnixTimestampToLocalTimeStr(unixTime, localTimeZone) {
            unixTime = fillUnixTime(unixTime);
            var commonTime = transferUnixTimestampToLocalTime(unixTime, localTimeZone);
            return commonTime.toLocaleDateString() + " " + commonTime.toTimeString().split(" ")[0];
        }

        /**
         * 将源时区的指定时间，转换为目标时区的时间
         *
         * @param inputTimeZone 源时区
         * @param outputTimeZone 目标时区
         * @param inputZoneTime 源时区时间
         * @param outputZoneTimeId 页面元素ID
         */
        function worldTimeConvert(inputTimeZone, outputTimeZone, inputZoneTime, outputZoneTimeId) {
            // 格式化输入时间
            inputZoneTime = inputZoneTime.replace(/-/g, "/") + " GMT" + inputTimeZone + "00";
            // inputZoneTime=inputZoneTime.replace(/-/g, "/");
            // 将输入时间转换为UTC时间戳
            date = new Date(inputZoneTime);

            timestamp = date.getTime() + (date.getTimezoneOffset() / 60 + parseInt(outputTimeZone)) * 3600000;

            document.getElementById(outputZoneTimeId).value = convertJsDateToString(new Date(timestamp));
        }


        /**
         * 将unicode转为中文
         */
        function transferUnicodeToChinese() {
            unicodeString = document.getElementById("unicodeString").value;
            document.getElementById("chineseString").value = eval("'" + unicodeString + "'");
            // execCopy("chineseString");
        }

        /**
         * 将中文转为unicode
         */
        function transferChineseToUnicode() {
            chineseString = document.getElementById("chineseString2").value;
            // document.getElementById("unicodeString2").value = escape(chineseString).replace(/%/g, "\\").toLowerCase();

            var ret = '';
            const ignoreCharArray = ['(', ')', ' ', '!', ',', '.', '!'];
            for (i = 0; i < chineseString.length; i++) {
                // console.log(chineseString[i]);
                var c = chineseString[i];
                if (ignoreCharArray.indexOf(c) == -1) {
                    encodeStr = escape(c);
                    if (encodeStr !== c) {
                        encodeStr = '\\u' + encodeStr.replace(/%u/g, "").replace(/%/g, "").padStart(4, "0");
                    }
                    ret += encodeStr;

                } else {
                    ret += c;
                }
            }
            document.getElementById("unicodeString2").value = ret;
            // execCopy("unicodeString2");
        }

        function toUnicode(str) {
            return str.replace(/([\u4E00-\u9FA5]|[\uFE30-\uFFA0])/g, function () {
                return "\\u" + RegExp["$1"].charCodeAt(0).toString(16);
            });
        }

        /**
         * 将02进制数转为其他进制 
         */
        function transFromBinary() {
            var inputValue = document.getElementById("binValue").value;
            radixTrans(inputValue, 2);
        }

        /**
         * 将08进制数转为其他进制 
         */
        function transFromOctal() {
            var inputValue = document.getElementById("octValue").value;
            radixTrans(inputValue, 8);
        }

        /**
         * 将10进制数转为其他进制 
         */
        function transFromDecimal() {
            var inputValue = document.getElementById("decValue").value;
            radixTrans(inputValue, 10);
        }

        /**
         * 将16进制数转为其他进制 
         */
        function transFromHexadecimal() {
            var endianValue = document.getElementById("endianValue").value;
            var inputValue = document.getElementById("hexValue").value;
            var bigEndianValue = "";
            if (endianValue == "0123") {
                bigEndianValue = inputValue;
            } else if (endianValue == "3210") {
                bigEndianValue = inputValue.split('').reverse().join('');
            } else {
                for (i = inputValue.length / 2; i > 0; i--) {
                    bigEndianValue = bigEndianValue + inputValue.charAt(i * 2 - 2) + inputValue.charAt(i * 2 - 1);
                }
            }
            radixTrans(bigEndianValue, 16);
        }

        /**
         * 进制转换 
         * 
         * @param inputValue 原始值
         * @param fromRadix  原始进制
         */
        function radixTrans(inputValue, fromRadix) {
            document.getElementById("binValue").value = parseInt(inputValue, fromRadix).toString(2);
            document.getElementById("octValue").value = parseInt(inputValue, fromRadix).toString(8);
            document.getElementById("decValue").value = parseInt(inputValue, fromRadix).toString(10);

            var hexValue = parseInt(inputValue, fromRadix).toString(16).toUpperCase();
            if (hexValue.length % 2 == 1) {
                hexValue = "0" + hexValue;
            }
            if (fromRadix != 16) {
                document.getElementById("hexValue").value = hexValue;
            }

            var hexValue1 = hexValue;
            document.getElementById("hexValue1").value = hexValue;

            var hexValue2 = hexValue.split('').reverse().join('');
            document.getElementById("hexValue2").value = hexValue2;

            var hexValue3 = "";
            for (i = hexValue.length / 2; i > 0; i--) {
                hexValue3 = hexValue3 + hexValue.charAt(i * 2 - 2) + hexValue.charAt(i * 2 - 1);
            }

            document.getElementById("hexValue3").value = hexValue3;
        }

        /**
         * 处理页面元素blur事件
         */
        function elementBlur(id) {
            blurElementId = id;
        }

        /**
         * 将js日期转换为 yyyy:MM:DD hh:mm:ss格式
         */
        function convertJsDateToString(jsDateTime) {
            var localeDateString = jsDateTime.toLocaleDateString();
            var timeString = jsDateTime.toTimeString().split(" ")[0];

            var dateArr = localeDateString.split("/");
            var timeArr = timeString.split(":");

            var year = dateArr[0].padStart(4, "0");
            var month = dateArr[1].padStart(2, "0");
            var day = dateArr[2].padStart(2, "0");
            var hour = timeArr[0].padStart(2, "0");
            var minute = timeArr[1].padStart(2, "0");
            var second = timeArr[2].padStart(2, "0");

            formatedDateTimeStr = year + "/" + month + "/" + day + " " + hour + ":" + minute + ":" + second;

            return formatedDateTimeStr;
        }

        /**
         * 进制转换 
         * 
         * @param inputValue 原始值
         * @param fromRadix  原始进制
         */
        function calculateExpression(expression) {
            document.getElementById("expressionValue").value = eval(expression);
        }

        function jsExecCmd(value) {
            var cmd = new ActiveXObject("WScript.Shell");
            /*
            命令参数说明
            cmd.exe /c dir 是执行完dir命令后关闭命令窗口。
            cmd.exe /k dir 是执行完dir命令后不关闭命令窗口。
            cmd.exe /c start dir 会打开一个新窗口后执行dir指令，原窗口会关闭。
            cmd.exe /k start dir 会打开一个新窗口后执行dir指令，原窗口不会关闭。
            */
            //执行完cmd命令后不关闭命令窗口。
            cmd.run("cmd.exe /k " + value);

            //执行完cmd命令后不关闭命令窗口。
            cmd.run("cmd.exe /k " + value);
            cmd = null;
        }

        function execCopy(str) {
            document.getElementById(str).select();
            document.execCommand("Copy");
        }

        function execTab(str, maxLen, next) {
            if (str.length > --maxLen) {
                document.getElementById(next).select();
                document.getElementById(next).focus();
            }
        }

        /**
         * 解析实时数据订阅块日志
         */
        function parseSubscribeBlock() {
            var inputValue = document.getElementById("subscribeBlock").value;
            // inputValue = '20019->2 30036->1';
            // inputValue = '20019->20';
            if (inputValue.length == 0) {
                // document.getElementById("regAddrList").value = '请输入订阅块日志';
                alert('请输入订阅块日志');
                return;
            }

            var reversedInputValue = inputValue.split('').reverse().join('');

            var regList = [];
            var pattern = /(\d{1,3})>-(\d{5})/g;

            var filedList = reversedInputValue.split(" ");
            for (i = 0; i < filedList.length; i++) {
                var field = filedList[i];

                if (field.length == 0) {
                    continue;
                }
                /*
                if (!pattern.test(field)) {
                    // document.getElementById("regAddrList").value = '订阅块日志格式错误';
                    alert('订阅块日志格式错误');
                    return;
                }
                */
                var matches;
                while (matches = pattern.exec(field)) {
                    var amount = parseInt(matches[1].split('').reverse().join(''));
                    var beginRegAddr = parseInt(matches[2].split('').reverse().join(''));

                    for (j = amount - 1; j >= 0; j--) {
                        var regAddr = beginRegAddr + j;
                        regList.push([regAddr]);
                    }
                }
            }

            var beginIndex = 0;
            regDetailList = [];
            regList.reverse().forEach(reg => {
                regDetailList.push([reg, beginIndex * 4, (beginIndex + 1) * 4 - 1]);
                beginIndex += 1;
            });

            var longFrameResp = document.getElementById("longFrameResp").value.trim();
            // longFrameResp = "123456789012";
            var retStr = [];
            if (longFrameResp.length == 0) {
                regDetailList.forEach(item => {
                    retStr.push(item[0] + ", " + item[1] + "~" + item[2]);
                });
                document.getElementById("regAddrList").value = retStr.join("\n");
                extendTextArea("regAddrList", 3, -1);
                return;
            }

            if (regDetailList.length != longFrameResp.length / 4) {
                alert("订阅日志和性能报文不匹配\r\n日志寄存器数量：" + regDetailList.length + "\r\n报文寄存器数量：" + longFrameResp.length / 4);
                return;
            }

            regDetailList.forEach(item => {
                retStr.push(item[0] + ":" + longFrameResp.substring(item[1], item[2] + 1));
            });
            document.getElementById("regAddrList").value = retStr.join("\n");
            extendTextArea("regAddrList", 3, -1);
        }

        function parseMessage() {
            var messageType = document.getElementById("messageType").value;
            var inputValue = document.getElementById("414bMessage").value.replaceAll(" ", "");
            // 414b请求报文样例
            // inputValue = "000F1102100B0001616621806166CA4001";
            // 414b响应报文样例
            // inputValue = "";
            // 4147响应报文样例
            // inputValue = "47057E1102030000000101";
            // 410e请求报文样例
            // inputValue = "4C10026100500A01616C4880616C49AB00513A0A2CD052084A07667470757365720C4368616E67656D655F3132331E6674702F706D73796E632F32303231313031382F307831302F3130303333";
            // 410e响应报文样例
            // inputValue = 0E04 1002 6101
            // 410f请求报文样例
            // inputValue = 0202 61
            // 410f响应报文样例
            // inputValue = 0F04 0261 0064

            // messageType = "410e";

            switch (messageType) {
                case '414b':
                    if (inputValue.length != 34) {
                        alert("414b报文长度非法，期望长度：34，实际长度：" + inputValue.length);
                        return;
                    }
                    parse414b(inputValue);
                    break;
                case '4147':
                    if (inputValue.length < 22) {
                        alert("4147报文长度非法，期望长度 > 22，实际长度：" + inputValue.length);
                        return;
                    }
                    parse4147(inputValue);
                    break;
                case '410e':
                    if (inputValue.length != 154) {
                        alert("410e报文长度非法，期望长度: 154，实际长度：" + inputValue.length);
                        return;
                    }
                    parse410e(inputValue);
                    break;
                default:
                    alert("Unsupported message type: " + messageType);
            }
        }

        /**
         * 将02进制数转为其他进制 
         */
        function parse414b(inputValue) {
            var result = [];
            // 数据长度
            var dataLength = inputValue.substr(0, 4);
            result.push([dataLength, "数据长度", parseInt(dataLength, 16).toString(10)]);
            // 文件类型
            var fileType = inputValue.substr(4, 2);
            result.push([fileType, "文件类型", fileType]);
            // 会话ID
            var sessionId = inputValue.substr(6, 2);
            result.push([sessionId, "会话ID", sessionId]);
            // Tag
            var custTag = inputValue.substr(8, 2);
            result.push([custTag, "Tag 0x" + custTag]);
            // Size
            var custDataLength = inputValue.substr(10, 2);
            result.push([custDataLength, "自定义数据长度", parseInt(custDataLength, 16).toString(10)]);
            // 设备ID
            var custDeivceId = inputValue.substr(12, 4);
            result.push([custDeivceId, "设备ID", custDeivceId]);
            // 开始时间
            var custStartTime = inputValue.substr(16, 8);
            result.push([custStartTime, "开始时间", transferUnixTimestampToLocalTimeStr(parseInt(custStartTime, 16).toString(10), "+00")]);
            // 结束时间
            var custEndTime = inputValue.substr(24, 8);
            result.push([custEndTime, "结束时间", transferUnixTimestampToLocalTimeStr(parseInt(custEndTime, 16).toString(10), "+00")]);
            // 时间类型
            var custTimeType = inputValue.substr(32, 2);
            custTimeTypeStr = custTimeType == 00 ? "GMT" : "本地时间";
            result.push([custTimeType, "时间类型", custTimeType + " " + custTimeTypeStr]);

            document.getElementById("resultListTextArea").value = getDisplayResult(result, 8);
            extendTextArea("resultListTextArea", result.length, -1);
        }

        function parse4147(inputValue) {
            var result = [];
            // subcode
            var subCode = inputValue.substr(0, 2);
            result.push([subCode, "子功能码", subCode]);
            // 数据长度
            var dataLength = inputValue.substr(2, 4);
            result.push([dataLength, "数据长度", parseInt(dataLength, 16).toString(10)]);
            // 文件类型
            var fileType = inputValue.substr(6, 2);
            result.push([fileType, "文件类型", fileType]);
            // sessionId
            var sessionId = inputValue.substr(8, 2);
            result.push([sessionId, "会话ID" + sessionId]);
            // transFlag
            var transFlag = inputValue.substr(10, 2);
            var transFlagStr;
            switch (transFlag) {
                case "00":
                    transFlagStr = "00 主动上报，无后续帧";
                    break;
                case "01":
                    transFlagStr = "01 响应请求上报，无后续帧";
                    break;
                case "02":
                    transFlagStr = "10 主动上报，有后续帧";
                    break;
                case "03":
                    transFlagStr = "11 响应请求上报，有后续帧";
                    break;
                default:
                    transFlagStr = transFlag;
            }
            result.push([transFlag, "传输标志位", transFlagStr]);
            // 414bCustDataLength
            var custDataLength = inputValue.substr(12, 2);
            var custDataLengthVal = parseInt(custDataLength) * 2;
            result.push([custDataLength, "自定义数据长度", custDataLength]);
            // 414bCustData
            var custData = inputValue.substr(14, custDataLengthVal);
            result.push([custData, "自定义数据", custData]);
            // frameId
            var frameId = inputValue.substr(14 + custDataLengthVal, 4);
            result.push([frameId, "帧序号", frameId]);
            // data
            var data = inputValue.substr(18 + custDataLengthVal);
            result.push([data, "文件数据", data]);

            document.getElementById("resultListTextArea").value = getDisplayResult(result, 8);
            extendTextArea("resultListTextArea", result.length, -1);
        }

        function parse410e(inputValue) {
            var dataArray = inputValue.split("");
            var result = [];
            var dataLength = getDataSegment(dataArray, 2);
            result.push([dataLength, "数据长度", parseInt(dataLength, 16).toString(10)]);
            var fileType = getDataSegment(dataArray, 2);
            result.push([fileType, "文件类型", fileType]);
            var sessionId = getDataSegment(dataArray, 4);
            result.push([sessionId, "SessionID", sessionId]);
            var transFlag = getDataSegment(dataArray, 2);
            result.push([transFlag, "传输类型", transFlag]);

            var tag50 = getDataSegment(dataArray, 2);
            result.push([tag50, "tag50", tag50]);
            var tag50DataLength = getDataSegment(dataArray, 2);
            result.push([tag50DataLength, "Tag50数据长度", parseInt(tag50DataLength, 16).toString(10)]);
            var tag50DevId = getDataSegment(dataArray, 2);
            result.push([tag50DevId, "设备编号", tag50DevId]);
            var tag50StartTime = getDataSegment(dataArray, 8);
            result.push([tag50StartTime, "开始时间", transferUnixTimestampToLocalTimeStr((parseInt(tag50StartTime, 16) + 8 * 3600).toString(10), "+00")]);
            var tag50EndTime = getDataSegment(dataArray, 8);
            result.push([tag50EndTime, "结束时间", transferUnixTimestampToLocalTimeStr((parseInt(tag50EndTime, 16) + 8 * 3600).toString(10), "+00")]);
            var tag50ReversedSegment = getDataSegment(dataArray, 2);
            result.push([tag50ReversedSegment, "保留位", tag50ReversedSegment]);

            var tag51 = getDataSegment(dataArray, 2);
            result.push([tag51, "tag51", tag51]);
            var tag51DataLength = getDataSegment(dataArray, 2);
            result.push([tag51DataLength, "Tag51数据长度", parseInt(tag51DataLength, 16).toString(10)]);
            var ip = getDataSegment(dataArray, 8);
            result.push([ip, "IP", parseIp(ip)]);
            var port = getDataSegment(dataArray, 4);
            result.push([port, "Port", parseInt(port, 16).toString(10)]);
            var userNameLen = getDataSegment(dataArray, 2);
            result.push([userNameLen, "用户名长度", parseInt(userNameLen, 16).toString(10)]);
            var userName = getDataSegment(dataArray, parseInt(userNameLen, 16) * 2);
            result.push([userName, "用户名", parseStr(userName)]);
            var passWordLen = getDataSegment(dataArray, 2);
            result.push([passWordLen, "密码长度", parseInt(passWordLen, 16).toString(10)]);
            var passWord = getDataSegment(dataArray, parseInt(passWordLen, 16) * 2);
            result.push([passWord, "密码", parseStr(passWord)]);
            var pathLen = getDataSegment(dataArray, 2);
            result.push([pathLen, "路径长度", parseInt(pathLen, 16).toString(10)]);
            var path = getDataSegment(dataArray, parseInt(pathLen, 16) * 2);
            result.push([path, "路径", parseStr(path)]);

            document.getElementById("resultListTextArea").value = getDisplayResult(result, 8);
            extendTextArea("resultListTextArea", result.length, -1);
        }

        function getDataSegment(dataArray, len) {
            var ret = "";
            while (len > 0) {
                ret += dataArray.shift();
                len--;
            }
            return ret;
        }

        function getDisplayResult(result, len) {
            displayResult = [];
            result.forEach(item => {
                var oriData = item[0].padStart(len, " ");
                if (oriData.length > len && len > 3) {
                    oriData = oriData.substr(0, len - 3) + "...";
                }

                var filedName = item[1];
                var filedValue = item[2];
                displayResult.push(oriData + " ：" + filedName + " " + filedValue);
            });
            return displayResult.join("\n");
        }

        function parseStr(originStr) {
            var ret = "";
            while (originStr.length > 0) {
                var tmp = originStr.substr(0, 2);
                ret += String.fromCharCode(parseInt(tmp, 16));
                originStr = originStr.substr(2);
            }
            return ret;
        }

        function parseIp(originStr) {
            var ret = [];
            while (originStr.length > 0) {
                var tmp = originStr.substr(0, 2);
                ret.push(parseInt(tmp, 16).toString(10));
                originStr = originStr.substr(2);
            }
            return ret.join(".");
        }

        function decodeUrl() {
            document.getElementById("decodedUrl").value = "";
            var encodedUrl = document.getElementById("encodedUrl").value;
            // encodedUrl = "https://10.44.208.82:31943/rest/neteco/web/organization/v2/tree?parentDn=%2F&self=true&incremental=true&pageId=1&cond=%7B%22BUSINESS_DEVICE%22%3A1%2C%22DOMAIN%22%3A0%2C%22DEVICE_TYPE%22%3A%2223023%2C23021%2C23020%2C23022%2C23010%2C23024%2C23050%2C23045%2C23039%2C23019%2C23040%2C23043%2C23051%2C23053%22%2C%22CONNECT_STATUS%22%3A%221%22%7D&_=1634124610047"
            if (encodedUrl.length == 0) {
                return;
            }
            console.log(encodedUrl);

            var fiedls = encodedUrl.split("?");
            if (fiedls.length == 1 && encodedUrl.startsWith("http")) {
                document.getElementById("decodedUrl").value = fiedls[0];
                return;
            }

            var decodedUrl = [];
            var paramsFields = ""
            if (encodedUrl.startsWith("http")) {
                decodedUrl.push(fiedls[0]);
                paramsFields = fiedls[1];
            } else {
                paramsFields = fiedls[0]
            }
            
            var params = paramsFields.split("&");
            var lineNum = 1;
            params.forEach(param => {
                var key = param.split("=")[0];
                var val = decodeURIComponent(param.split("=")[1]);
                decodedUrl.push(key += "=" + val);
                lineNum += 1;
            });
            console.log(decodedUrl);
            console.log(decodedUrl.length);
            document.getElementById("decodedUrl").value = decodedUrl.join("\n");
            extendTextArea("decodedUrl", decodedUrl.length, -1);
        }

        function encodeUrl() {
            document.getElementById("encodedUrl").value = "";
            var decodedUrl = document.getElementById("decodedUrl").value;
            if (decodedUrl.length == 0) {
                return;
            }
            // console.log(decodedUrl);
            var lines = decodedUrl.split("\n");
            var encodedUrl = '';
            var isBasicUrl = decodedUrl.startsWith("http");
            lines.forEach(param => {
                if (isBasicUrl) {
                    encodedUrl += param + "?";
                    isBasicUrl = false;
                    return;
                }
                var index = param.indexOf("=")
                var key = param.substring(0, index);
                var val = encodeURIComponent(param.substring(index + 1));
                encodedUrl += key + "=" + val + "&";
            });
            console.log(encodedUrl);
            document.getElementById("encodedUrl").value = encodedUrl.substr(0, encodedUrl.length - 1);
        }

        function extendTextArea(elementById, height, width) {
            if (height !== -1) {
                document.getElementById(elementById).style.height = height * 20 + 'px';
            }
            if (width !== -1) {
                document.getElementById(elementById).style.width = width * 18 + 'px';
            }
        }

    </script>
</head>

<body>
    <div>
        <img src="http://www.huawei.com/Assets/CBG/img/logo.png" />
    </div>

    <div id="frame">
        <div id="header1">sTool v0.9.2 beta</div>

        <!-- 时间转换 -->
        <p>
            <label style="font-weight: bold;">各时区时间转换为Unix时间戳</label>
        </p>

        <div class="field">
            <select name="inputTimeZone2" id="inputTimeZone2">
                <option value="-11">-11中途岛</option>
                <option value="-10">-10檀香山</option>
                <option value="-09">-09阿拉斯加</option>
                <option value="-08">-08洛杉矶</option>
                <option value="-07">-07凤凰城</option>
                <option value="-06">-06墨西哥城</option>
                <option value="-05">-05纽约</option>
                <option value="-04">-04圣地亚哥</option>
                <option value="-03">-03巴西利亚</option>
                <option value="-02">-02费尔南多</option>
                <option value="-01">-01佛德尔群岛</option>
                <option value="+00">+00伦敦</option>
                <option value="+01">+01巴黎</option>
                <option value="+02">+02雅典</option>
                <option value="+03">+03莫斯科</option>
                <option value="+04">+04阿布扎比</option>
                <option value="+05">+05伊斯兰堡</option>
                <option value="+06">+06仰光</option>
                <option value="+07">+07新加坡</option>
                <option value="+08" selected>+08北京</option>
                <option value="+09">+09东京</option>
                <option value="+10">+10墨尔本</option>
                <option value="+11">+11所罗门群岛</option>
                <option value="+12">+12惠灵顿</option>
            </select>
            时间
            <input id="year" type="text" style="width:42px" size="12" onkeyup="execTab(year.value,4,'month')" />年
            <input id="month" type="text" style="width:26px" size="12" onkeyup="execTab(month.value,2,'day')" />月
            <input id="day" type="text" style="width:26px" size="12" onkeyup="execTab(day.value,2,'hour')" />日
            <input id="hour" type="text" style="width:26px" size="12" onkeyup="execTab(hour.value,2,'minute')" />时
            <input id="minute" type="text" style="width:26px" size="12" onkeyup="execTab(minute.value,2,'second')" />分
            <input id="second" type="text" style="width:26px" size="12"
                onkeyup="execTab(second.value,2,'transferUtcTimeToUnixTime')" />秒
            <input id="transferUtcTimeToUnixTime" type="button" value="转换为Unix时间"
                onclick="transferUtcTimeToUnixTime(inputTimeZone2.value)" />
            <input id="unixTimeOut" type="text" style="width:125px" size="12" />
        </div>

        <p>
            <label style="font-weight: bold;">Unix时间转换为各时区时间</label>
        </p>
        <div class="field">
            <input id="unixTimeIn1" type="text" style="width:160px" size="12" />
            <input type="button" value="转换为指定时区时间" onclick="transferUnixTimestampToLocalTimeJs(inputTimeZone1.value)" />
            <select name="inputTimeZone1" id="inputTimeZone1">
                <option value="-11">-11中途岛</option>
                <option value="-10">-10檀香山</option>
                <option value="-09">-09阿拉斯加</option>
                <option value="-08">-08洛杉矶</option>
                <option value="-07">-07凤凰城</option>
                <option value="-06">-06墨西哥城</option>
                <option value="-05">-05纽约</option>
                <option value="-04">-04圣地亚哥</option>
                <option value="-03">-03巴西利亚</option>
                <option value="-02">-02费尔南多</option>
                <option value="-01">-01佛德尔群岛</option>
                <option value="+00">+00伦敦</option>
                <option value="+01">+01巴黎</option>
                <option value="+02">+02雅典</option>
                <option value="+03">+03莫斯科</option>
                <option value="+04">+04阿布扎比</option>
                <option value="+05">+05伊斯兰堡</option>
                <option value="+06">+06仰光</option>
                <option value="+07">+07新加坡</option>
                <option value="+08" selected>+08北京</option>
                <option value="+09">+09东京</option>
                <option value="+10">+10墨尔本</option>
                <option value="+11">+11所罗门群岛</option>
                <option value="+12">+12惠灵顿</option>
            </select>

            <input id="utcTime1" type="text" style="width:270px" size="12" />
        </div>


        <p>
            <label style="font-weight: bold;">世界标准时间转换</label>
        </p>
        <div class="field">
            <select name="inputTimeZone" id="inputTimeZone">
                <option value="-11">-11中途岛</option>
                <option value="-10">-10檀香山</option>
                <option value="-09">-09阿拉斯加</option>
                <option value="-08">-08洛杉矶</option>
                <option value="-07">-07凤凰城</option>
                <option value="-06">-06墨西哥城</option>
                <option value="-05">-05纽约</option>
                <option value="-04">-04圣地亚哥</option>
                <option value="-03">-03巴西利亚</option>
                <option value="-02">-02费尔南多</option>
                <option value="-01">-01佛德尔群岛</option>
                <option value="+00">+00伦敦</option>
                <option value="+01">+01巴黎</option>
                <option value="+02">+02雅典</option>
                <option value="+03">+03莫斯科</option>
                <option value="+04">+04阿布扎比</option>
                <option value="+05">+05伊斯兰堡</option>
                <option value="+06">+06仰光</option>
                <option value="+07">+07新加坡</option>
                <option value="+08" selected>+08北京</option>
                <option value="+09">+09东京</option>
                <option value="+10">+10墨尔本</option>
                <option value="+11">+11所罗门群岛</option>
                <option value="+12">+12惠灵顿</option>
            </select>
            <input id="inputZoneTime" type="text" style="width:185px" size="12" />
            <input type="button" value="<<"
                onclick="worldTimeConvert(outputTimeZone.value, inputTimeZone.value, outputZoneTime.value, 'inputZoneTime')" />
            <input type="button" value=">>"
                onclick="worldTimeConvert(inputTimeZone.value, outputTimeZone.value, inputZoneTime.value, 'outputZoneTime')" />
            <select name="outputTimeZone" id="outputTimeZone">
                <option value="-11">-11中途岛</option>
                <option value="-10">-10檀香山</option>
                <option value="-09">-09阿拉斯加</option>
                <option value="-08">-08洛杉矶</option>
                <option value="-07">-07凤凰城</option>
                <option value="-06">-06墨西哥城</option>
                <option value="-05">-05纽约</option>
                <option value="-04">-04圣地亚哥</option>
                <option value="-03">-03巴西利亚</option>
                <option value="-02">-02费尔南多</option>
                <option value="-01">-01佛德尔群岛</option>
                <option value="+00" selected>+00伦敦</option>
                <option value="+01">+01巴黎</option>
                <option value="+02">+02雅典</option>
                <option value="+03">+03莫斯科</option>
                <option value="+04">+04阿布扎比</option>
                <option value="+05">+05伊斯兰堡</option>
                <option value="+06">+06仰光</option>
                <option value="+07">+07新加坡</option>
                <option value="+08">+08北京</option>
                <option value="+09">+09东京</option>
                <option value="+10">+10墨尔本</option>
                <option value="+11">+11所罗门群岛</option>
                <option value="+12">+12惠灵顿</option>
            </select>
            <input id="outputZoneTime" type="text" style="width:190px" size="12" />
        </div>

        <!-- Unicode转换 -->
        <br />
        <p>
            <label style="font-weight: bold;">普通字符转Unicode</label>
        </p>
        <div class="field">
            <input id="chineseString2" type="text" style="width:300px" size="12" />
            <input type="button" style="width:83px" value="转Unicode" onclick="transferChineseToUnicode()" />
            <input id="unicodeString2" type="text" style="width:305px" size="12" />
        </div>

        <p>
            <label style="font-weight: bold;">Unicode转普通字符</label>
        </p>
        <div class="field">
            <input id="unicodeString" type="text" style="width:300px" size="12" />
            <input type="button" value="转普通字符" onclick="transferUnicodeToChinese()" />
            <input id="chineseString" type="text" style="width:305px" size="12" />
        </div>

        <!-- 进制转换 -->
        <!--
        <br/>
        <p>
            <label style="font-weight: bold;">进制转换</label>
        </p>
        <div class="field">
            02进制
            <input id="binValue" type="text" style="width:264px;text-align:right" size="12" onblur="elementBlur('2')" />
            <input type="button" value="转换" onclick="transFromBinary()" />
        </div>
        <div class="field">
            08进制
            <input id="octValue" type="text" style="width:264px;text-align:right" size="12" onblur="elementBlur('8')" />
            <input type="button" value="转换" onclick="transFromOctal()" />
        </div>
        <div class="field">
            10进制
            <input id="decValue" type="text" style="width:264px;text-align:right" size="12"
                onblur="elementBlur('10')" />
            <input type="button" value="转换" onclick="transFromDecimal()" />
        </div>
        <div class="field">
            16进制
            <select name="endianValue" id="endianValue">
                <option value="0123" selected>大端序</option>
                <option value="3210">小端序</option>
                <option value="2301">小端序(16)</option>
            </select>
            <input id="hexValue" type="text" style="width:168px;text-align:right" size="12"
                onblur="elementBlur('16')" />
            <input type="button" value="转换" onclick="transFromHexadecimal()" />
            
            &nbsp;&nbsp;大端序 <input id="hexValue1" type="text" style="width:168px;text-align:right" size="12" readonly="true" />
            小端序 <input id="hexValue2" type="text" style="width:168px;text-align:right" size="12" readonly="true" />
            16位寄存器小端 <input id="hexValue3" type="text" style="width:168px;text-align:right" size="12" readonly="true" />
            
        </div>
        <br/>
        -->

        <!-- 表达式求值 -->
        <!--
        <p>
            <label style="font-weight: bold;">表达式求值</label>
        </p>
        <div class="field">
            <input id="expression" type="text" style="width:315px" size="12" onblur="elementBlur('16')" />
            <input type="button" value="计算" onclick="calculateExpression(expression.value)" />
            &nbsp;&nbsp;<input id="expressionValue" type="text" style="width:168px" size="12" readonly="true" />
        </div>
        
        -->

        <!-- 订阅块日志解析 -->
        <br />
        <p>
            <label style="font-weight: bold;">订阅块日志解析</label>
        </p>
        <div class="field">
            订阅日志 <input id="subscribeBlock" type="text" style="width:300px;text-align:left" size="12" />
        </div>
        <div class="field">
            性能报文
            <input id="longFrameResp" type="text" style="width:300px;text-align:left" size="12" />
            <input type="button" value="解析" onclick="parseSubscribeBlock()" />
        </div>
        <div class="field">
            <!--解析结果-->
            <!--
            <textarea rows="1" style="width:300px;text-align:left" id="regAddrList" readonly="true"></textarea>
            -->
            <textarea rows="1" style="width:365px;text-align:left" id="regAddrList" readonly="true"></textarea>
        </div>

        <!-- 414b/4147报文解析 -->
        <br />
        <p>
            <label style="font-weight: bold;">报文解析</label>
        </p>
        <div class="field">
            <select name="messageType" id="messageType">
                <option value="414b" selected>414b</option>
                <option value="4147">4147</option>
                <option value="410e">410e</option>
            </select>
            <input id="414bMessage" type="text" style="width:305px;text-align:left" size="12"
                onblur="elementBlur('2')" />
            <input type="button" value="解析" onclick="parseMessage()" />
        </div>
        <div class="field">
            <textarea rows="1" cols="160" id="resultListTextArea"></textarea>
        </div>

        <!-- URL编解码 -->
        <br />
        <p>
            <label style="font-weight: bold;">URL编解码</label>
        </p>
        <div class="field">
            <input id="encodedUrl" type="text" style="width:1300px;text-align:left" size="12" />
        </div>
        <div class="field">
            <input type="button" value="URL解码↓" onclick="decodeUrl()" />
            <input type="button" value="URL编码↑" onclick="encodeUrl()" />
        </div>
        <div class="field">
            <textarea rows="1" cols="160" id="decodedUrl"></textarea>
        </div>

    </div>

</body>

</html